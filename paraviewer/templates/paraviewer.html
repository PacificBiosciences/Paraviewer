<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8'>
    <title>Paraviewer</title>
    <link rel="icon" type="image/png" href="logo_Paraphase.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter2/1.4.7/crossfilter.min.js"
        type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dc/3.0.12/dc.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"
        type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.5.0/viewer.min.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/v/bs4/dt-1.10.20/b-1.6.1/b-html5-1.6.1/sc-2.0.1/sl-1.3.1/datatables.min.js"
        type="text/javascript"></script>
    <script>
        window.appData = {
            data: {{ data.table_data|tojson }},
            has_pedigree_columns: {{ data.has_pedigree_columns|tojson }}
        };
    </script>
    <script src="js/app.js" type="text/javascript"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.5.0/viewer.min.css" rel="stylesheet"
        type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" rel="stylesheet"
        type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
        type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/dc/3.0.12/dc.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.datatables.net/v/bs4/dt-1.10.20/b-1.6.1/b-html5-1.6.1/sc-2.0.1/sl-1.3.1/datatables.min.css"
        rel="stylesheet" type="text/css" />
    <link href="stylesheets/styles.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/igv@3.4.0/dist/igv.min.js"></script>
    <link rel="stylesheet" href="stylesheets/igv.css">
</head>

<body>
    <nav class="navbar navbar-dark p-0 pl-2">
        <div class="navbar-center-container">
            <div class="navbar-brand text-light p-0">
                <img src="logo_Paraphase.svg" class="navbar-logo d-inline-block mr-3" alt="Logo">
                Paraviewer
            </div>
        </div>
        <a class="github-link github-container pr-2" href="https://github.com/PacificBiosciences/paraphase"
            target="_blank">
            <img src="github-mark-white.png" class="navbar-logo" alt="GitHub link">
            <span class="github-label">See it on GitHub</span>
        </a>
    </nav>

    <div id="help-div" class="help-div" style="display: none;">
        <h4>User help</h4>
        <ul class="help-list">
            <li>Click the "Quick View" button to view a variant image. Sample names with '-trio' at the end will include
                paternal,
                maternal, and sample info in the image.</li>
            <li>Use left/right arrow keys to navigate between rows.</li>
            <li>Click Chrom, Region, Sample, Copy Number, Family ID, Paternal ID, Maternal Id, Sex, or Phenotype values
                to filter.</li>
            <li>Click the View Trio <i class="fas fa-users"></i> button to view only a trio of samples (Paternal,
                Maternal, and Sample) together. Consider combining with the Region filter.</li>
            <li>Use the filter button <i class="fas fa-filter"></i> for advanced filtering.</li>
            <li>To view BAM files in IGV.js (in-browser):
                <ul class="help-sublist">
                    <li>For local Paraviewer sessions (on your local computer): Click IGV <i
                            class="fas fa-external-link-alt"></i> button and select the project directory - you'll see a
                        warning but files will not be uploaded to a remote location.</li>
                    <li>For remote Paraviewer sessions (on a server): Click IGV <i class="fas fa-external-link-alt"></i>
                        button to open directly in browser.</li>
                </ul>
            </li>
            <li>IGV Session download options:
                <ul class="help-sublist">
                    <li>Click IGV <i class="fas fa-download"></i> button to download XML session file, then right-click
                        and choose click Save Page As.</li>
                    <li>Click BAM/BAI <i class="fas fa-download"></i> buttons to download alignment files - these must
                        be stored in the same location as the corresponding IGV session file.</li>
                </ul>
            </li>
            <li>IGV Session download options for trios: Download the BAM/BAI files from the three trio members and the
                IGV session file from the '-trio' row.</li>
            <li>Special Info fields provide annotation insights specific to regions when the mouse hovers over the
                record row. For example:
                <ul class="help-sublist">
                    <li>SMN Special Info includes the SMN1 and SMN2 copy number.</li>
                    <li>HBA Special Info includes a sample genotype call, where possible.</li>
                    <li>Many regions show possible pathogenic vars in each named haplotype - these may appear in the
                        gene or pseudogene.</li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="modal fade" id="filter-modal" tabindex="-1" role="dialog" aria-labelledby="filter-modal"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="flex-column">
                        <h5 class="modal-title" id="filter-modal">Filters</h5>
                        <h7 class="pl-2 text-secondary" id="variant-count">
                            <a href="javascript:resetFilter()">Reset All</a>
                        </h7>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-6">
                                <div class="row pt-2">
                                    <div class="col">
                                        <h5>Sample</h5>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-12">
                                        <div id="sample-search"></div>
                                    </div>
                                </div>
                                <div class="row pt-2">
                                    <div class="col">
                                        <h5>Copy Number</h5>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-12">
                                        <div id="copy-number-search"></div>
                                    </div>
                                </div>
                                {% if data.has_pedigree_columns.PaternalID %}
                                <div class="row pt-2">
                                    <div class="col">
                                        <h5>Paternal ID</h5>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-12">
                                        <div id="paternal-id-search"></div>
                                    </div>
                                </div>
                                {% endif %}
                                {% if data.has_pedigree_columns.Sex %}
                                <div class="row pt-2">
                                    <div class="col">
                                        <h5>Sex</h5>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-12">
                                        <select id="sex-search" class="form-control">
                                            <option value="">Select Sex...</option>
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <!-- Right Column -->
                            <div class="col-6">
                                <div class="row pt-2">
                                    <div class="col">
                                        <h5>Region</h5>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-12">
                                        <div id="region-search"></div>
                                    </div>
                                </div>
                                {% if data.has_pedigree_columns.FamilyID %}
                                <div class="row pt-2">
                                    <div class="col">
                                        <h5>Family ID</h5>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-12">
                                        <div id="family-id-search"></div>
                                    </div>
                                </div>
                                {% endif %}
                                {% if data.has_pedigree_columns.MaternalID %}
                                <div class="row pt-2">
                                    <div class="col">
                                        <h5>Maternal ID</h5>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-12">
                                        <div id="maternal-id-search"></div>
                                    </div>
                                </div>
                                {% endif %}
                                {% if data.has_pedigree_columns.Phenotype %}
                                <div class="row pt-2">
                                    <div class="col">
                                        <h5>Phenotype</h5>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-12">
                                        <div id="phenotype-search"></div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <!-- Full-width Chromosome section at bottom -->
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="row" id="chrom-chart">
                                    <div class="col-4">
                                        <h5>Chromosome</h5>
                                    </div>
                                    <div class="col-8 text-right">
                                        <span class="reset text-muted" style="display: none;">[<span
                                                class="filter"></span>]</span>
                                        <a class="reset" href="javascript:chromChart.filterAll();dc.redrawAll();"
                                            style="display: none;">Reset</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal"
                        onclick="javascript:dc.filterAll(); dc.renderAll();"
                        title="Clear selection and close">Cancel</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal"
                        title="Apply filters">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid h-90">
        <div class="row" id="variant-table-placeholder">
            <div class="col-12">
                <div style="height:415px">
                    <div class="d-flex justify-content-center align-items-center text-muted h-100">
                        <div class="d-flex flex-column">
                            <i class="fas fa-10x fa-table"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row pb-1" id="variant-table-div" hidden>
            <div class="col-12">
                <div class="table-responsive">
                    <table id="variant-table" class="table table-hover display nowrap" width="100%"></table>
                </div>
            </div>
        </div>
    </div>

    <div id="context-menu" class="custom-context-menu">
        <div class="context-menu-item" id="copy-page-url">Copy Page URL with Hash</div>
        <div class="context-menu-item" id="view-image">View Image</div>
    </div>

    <div class="clipboard-success">URL copied to clipboard!</div>
    <div class="modal fade" id="igv-modal" tabindex="-1" role="dialog" aria-labelledby="igv-modal-label"
        aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="igv-modal-label">IGV Viewer</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="igv-viewer"></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>